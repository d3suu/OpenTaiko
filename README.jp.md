# OpenTaiko
OpenTaikoは、GPLv3されてる音ゲームです。D言語で書いてあって、グラフィックはSDL2([DerelictSDL2][3])で、サウンドとしてはSFML2([DerelictSFML2][4])を利用しています。

![曲選択画面](screenshot0.png)

![遊び中](screenshot1.png)

_スクリーンショットは現在のゲームと違っている可能性があります。_

# 始める前に
OpenTaikoを使えるようになる前に、コンパイラーとその他の必要なことをじゅんびしましょう。違うOSは違うインストール方法がありますので、気をつけてください。バイナリーリリースに関している機能は詳しく決めてないため、まだ配信しません。

# コンパイラー
現在、dmdしか完全に対応しません。しかし、場合によって他のコンパイラーも使えるようになるかもしれません。なお、ldcサポートは将来の目的です。

dmdとderelict-sdl2のバグのため、dmdを使えると「-release」フラグをつけば実行時にエラーが出てしまいそうなので、現在「debug」しか利用できません。

# 要り物（パッケージなど）
* dmd
* dub
* SDL >= 2.0
* SDL2\_ttf
* SDL2\_image
* ffmpeg、コマンドライン系（SFML2はmp3対応がないので、ffmpeg使えれば遊ぶ時にmp3をoggに、再生できられる）
* csfml-audio-2

利用しているプラットフォームにcsfmlがない場合はSDL\_mixerも使えられるが、音楽再生計時能がなくて、正しく実行しない場合があります。なお、音質が悪くなる可能性もありますので、できればcsfmlを使ってください。

## DUB dependencies
dub.sdlをご覧ください。

## プラットフォーム特有やり方
自分のOSの特有やり方をここにつけてもどうぞ。もうやったってところがあればもちろん、やり直す必要がありません。

### Linux
どんなディストロでもOpenTaikoはコンパイルと実行するはずです。

#### 一般的に
ディストロのパッケージマネージャーを使って、「要り物」から各を探してインストールのが基本的なやり方です。普通にこんなところまでです。

#### Debian/Devuan (stable)
aptを使って、こちらのパッケージをインストールします。

* libsdl2-2.0-0
* libsdl2-image-2.0-0
* libsdl2-ttf-2.0-0
* libcsfml-audio2.3
* ffmpeg

```
apt install libsdl2-2.0-0 libsdl2-image-2.0-0 libsdl2-ttf-2.0-0 libcsfml-audio2.3 ffmpeg
```

dubとdmdが公的なリポジトリにありませんので、dlang.orgからの [official installer](https://dlang.org/download.html)を使います。

```
wget http://downloads.dlang.org/releases/2.x/2.084.0/dmd_2.084.0-0_amd64.deb
```

付け込んでいる.sigファイルを使ってインストール前にパッケージの確認を行いましょう。

```
sudo dpkg -i dmd_2.084.0-0_amd64.deb
```

### Windows
まず、[dlang.org](https://dlang.org/download.html#dmd)からdmd installer exeを手に入ります。説明どおりにインストールして、Visual Studio対応の質問に「do nothing」を答えてdmdとdubがインストール込みのを待つだけです。

gitを持っている場合はgit cloneでOpenTaikoのリポジトリをクローンします。でもWindowsで使い辛いし、持っていない方は.zipを手に入ることもできますので、実験だけがしたい方に一番便利な方法かもしれません。

次は必要な.dllファイルとffmpegを手に入ります。64-bitマシンが持っている方に64-bitの.dllが必要で、32-bitマシンは32-bitの.dllなので、気をつけて正しいのをダウンしましょう。ダウンした.dllをOpenTaikoディレクトリに運びます。SDL2なら様々な.dllが付いていますので、必ずそれもこれも運びましょう。こちらの.dllをダウンロードします。

* [SDL2](http://libsdl.org/download-2.0.php)
* [SDL2-ttf](https://www.libsdl.org/projects/SDL_ttf/) 「Runtime Binaries」下のWindows系を選びます
* [SDL2-image](https://www.libsdl.org/projects/SDL_image/)前と同じくやって、zlibを書き換えても構いません
* [CSFML](https://www.sfml-dev.org/download/csfml/)、Windowsの一番新しいやつを。ダウンした.zipの「bin」ディレクトリから「csfml-audio-2.dll」を運ぶだけで十分です

その後は前と同じように[ffmpeg.exe](https://ffmpeg.zeranoe.com/builds/)をダウンロードして、ffmpeg.exeをOpenTaikoディレクトリに運びます。今度も要る実行ファイルが「bin」ディレクトリにあります。

つついては[OpenAL redistributable](http://openal.org/downloads/oalinst.zip)を手に入ります。インストーラーを実行したくない場合は[SFML builds](https://www.sfml-dev.org/download/sfml/2.5.1/)からのバージョンを選んで、付け込んでいるopenal32.dllを前と同じように使えても平気です。

OpenTaikoのコンパイル準備ができました。cmdを実行してOpenTaikoディレクトリを選びます。簡単に正しいディレクトリを選べるようにExplorerのアドレスバーからcdコマンド後にコピペできます。スペースや特別文字があるパスならご覧のように「"」の取り巻くを行いましょう。

```
cd "C:\Users\gtensha\Projects\OpenTaiko-0.2"
```

最後はビルドを行いだけです。64-bitマシンなら--arch=x86\_64のフラグを付きましょう。32-bitの場合は--arch=x86を使えます。それと--config=SFMLMixerのフラグも必要です。フラグを付けてdub buildのコマンドを実行します。

```
dub build --config=SFMLMixer --arch=x86_64
```

最初ならdubがネットからdependencyをGETしますので少々待ってください。

完成したらOpenTaiko.exeがディレクトリに出てきました。OpenTaikoの実行時にエラーが出たら、もう一同上のことを確認してください。特に、マシンに正しいdllバージョンを手に入れたことを確認してください。

### BSD
ただいまBSDのサポートがよく確認していませんが、ほとんどのBSDは必要なライブラリーが利用可能ので、できるかもしれません。

### MacOS
状況不明なのですが、できるはずです。

## ビルド方法
OpenTaikoはビルドシステムとしてdubを利用しています。dubはOSのコマンドラインから実行します。なお、作業ディレクトリはOpenTaikoにクローンしたディレクトリにセットします。

```
dub run
```

を実行したら、OpenTaikoはビルドされて、実行します。

```
dub build
```

ならビルドだけを行います。まだSFMLサポートに必要なので
```--config=SFMLMixer```
フラグも忘れないように。

どちらのコマンド系を選んでも本ディレクトリにOpenTaikoの実行ファイルが出てきます。ほかのディレクトリに運びせずに後から自由に実行できます。

本マシンにコンパイルしたい方は普通にプロセッサーのISAを特定する必要がないのですが、64-bitのWindowsユーザーなら特定しないと32-bitバイナリーになるし、64-bit dllを利用できなくなります。フラグとして
```
--arch=x86_64
```
を付いたら64-bitのビルドを行います。自由にフラグを交えて実行します。

```
dub build --config=SFMLMixer --arch=x86
```

上のコマンドはSFMLサポート付きの32-bit x86ビルドとなります。

初ビルドにはネットからdependenciesのダウンロードによって少々時間がかかるかもしれません。この時はネットワーク接続が必要なので気をつけてください。その後は自由にオフラインでも作業をつついても平気です。手でdependencyを手に入る方法に関してる情報が知りたいならdubの文書化をご覧ください。

## 遊び方
OpenTaikoはキーボードで遊べます。コントローラーのサポートは将来の目的です。一人だけじゃなくて、同じキーボードで（もしは本コンピューターに接続されてる他のキーボードもOK）数人と同時に遊ぶこともできます。

### キーボード使い方
メニューをナビてドラムを叩くにはキーボードを使います。マウスはサポートされていません。

メニューのナビをするには矢印キーを使えます。ENTERをおとすと決定し、ESCAPEなら前のメニューに戻ります。タイトルまでおとしたらゲームを終了します。メニューカテゴリから選択するにはTABをおとせます。

遊ぶ時にプレイヤー１の叩くキーはデフォールト[D F J K]に設定されています。Dは左カツで、Fは左ドンと言う感じになります。プレイヤー２の場合は[End PageDown Numpad8 Numpad9]に設定されています。

#### キーを変化する
叩くキーを変化するには「プレイヤー」メニューにナビして、「叩けるキーを変化する」オプションを選択します。プレイヤー号と追加したいキーを選択して、ESCAPE以外いずれかのキーをおとしたらそのキーは追加されます。

キーの設定は_keybinds.json_に登録しています。このファイルは手で変化しても平気です。設定はプレイヤー号に関しているだけです。特定のプレイヤーに設定していません。

いずれかのプレイヤー号のキーを消したくなったら、「プレイヤー」メニューにある機能を使えます。

### プレイヤーを追加する
始めに_Player_のプレイヤーをもらいます。他のプレイヤーを登録するには、「プレイヤー」メニューに移動して、「相手を追加する」オプションを選択します。その後は登録されたプレイヤーから選べ、もしは新しいプレイヤーを登録するのもできます。プレイヤーを追加すると遊ぶ時に各プレイヤーがプレイヤーエリアをもらえられて、同時に遊べます。遊んでいるプレイヤーは右上に表示されます。

「相手を抜かす」オプションはプレイヤーを演奏から抜かすためです。登録されたプレイヤー一覧から消しません。

プレイヤー一覧は_players.json_に登録されています。そちらも、手で変更を行っても平気です。

### 曲を追加する
曲を追加するには自分でゲーム譜面を作るか誰かが創作したのを手に入ることもできます。なお、ゲームによって他のから譜面をインポートするのも可能です。

#### ゲーム譜面の制作
制作機能はまだ完全に決めてないので、間怠くて手で制作できます。やり方を習うにはmapsディレクトリーにある見本をご覧ください。

制作されたゲーム譜面を追加するにはそのマップのディレクトリーをmapsにコピーするだけです。

#### ゲーム譜面をインポートする
.oszファイルからゲーム譜面をインポートすることができます。自動的にその中にあるbeatmapをOpenTaikoの譜面ファイルに変更して、ffmpegが利用可能ならmp3もoggに変更します。ffmpegを持ってないならゲーム中に音楽が再生できない可能性があります。インポート後で.oszは消しません。

インポートするには「設定」メニューから「マップをインポートする」のボタンをおとしてください。

### ゲーム設定
「設定」メニューに言語を設定したりvsyncモードをセットしたりこととかができます。レゾリューションをセットするには_settings.json_のファイルをエディットして、「resolution」を好きな価に変更できます。

現在では設定した後でゲームを再始動必要があります。

### 遊び方
ドラムが受け入れ場に向かってるとキーボードで正しいタイミング叩きます。赤のドラムは中のキーで、緑のドラムは辺のキーで叩きます。右や左のボタンのどっちでもOKです。タイミングがいいならスコアもよくなります。リズムをよく聞いて叩くのはコツです！

開発が進むともっと機能が追加されます。

# 目的
どんなマシンを使っても遊べる音ゲーになること。

同じマシンでもネットでもマルチプレイヤー機能があって、楽しくて楽にできること。

同じ感じのゲームからマップのインポートができたり、簡単にテキストファイルの変化を行ってマップ作成できたりすること。

コードにたいして誰でも簡単に変化するように、ソースコードが読みやすくてよく実行すること。直したり追加したりこといっぱいあるのでその状況になるまでももちろん投稿が受け入れられています。

OpenTaikoはGNU GPLv3のフリーソフトため、すべてをフリーソフトままで配信できるようにフリーな共有ライブラリを使いのみのこと。

# コピーライト知らせ
こちらのレポジトリーに付いているファイルは作者よりコピーライトされたものです。

## Noto fonts
**© 2010-2015, Google Corporation**

### ファイル

* assets/default/NotoSansCJK-Bold.ttc
* assets/default/NotoSansCJK-Light.ttc
* assets/default/NotoSansCJK-Regular.ttc

### ライセンス
[SIL Open Font License](assets/default/LICENSE.NotoSansCJK.txt)

### ホームページ
[GitHubレポジトリー](https://github.com/googlei18n/noto-cjk)

[3]: https://github.com/DerelictOrg/DerelictSDL2
[4]: https://github.com/DerelictOrg/DerelictSFML2
